<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>DIPLOMACY.OS // BOOT</title>

<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<link rel="icon" href="favicon.ico">

<style>
  :root{
    --bg:#000000;
    --green:#00ff88;
    --blue:#4fd0ff;
    --orange:#ff8a3c;
    --amber:#ffcc66;
  }

  html,body{height:100%}

  body{
    margin:0;
    font-family:"VT323", monospace;
    background:radial-gradient(circle at top, #050b09 0, #000 55%);
    background-size:140% 140%;
    animation:bgPulse 32s ease-in-out infinite alternate;
    color:var(--green);
    overflow:hidden;
    letter-spacing:.5px;
    transition:
      background 2.4s ease,
      color 1.4s ease,
      filter 1.6s ease,
      transform .4s ease;
  }

  body.orange-phase{
    background:radial-gradient(circle at 20% -10%, #2a1200 0, #000 60%);
    color:var(--orange);
  }

  body.quiet-phase{
    filter:brightness(.9) contrast(1.1);
  }

  body.stage3-shake{
    animation:globalShake .45s infinite;
  }

  .overlay-scan{
    position:fixed; inset:0; pointer-events:none;
    background:repeating-linear-gradient(
      to bottom,
      rgba(255,123,36,.12) 0px,
      rgba(255,123,36,.07) 1px,
      rgba(0,255,136,.05) 3px,
      transparent 5px
    );
    mix-blend-mode:screen;
    opacity:.75;
    animation:scanShift 7s linear infinite;
    transition:opacity 2s ease;
  }
  body.orange-phase .overlay-scan{
    background:repeating-linear-gradient(
      to bottom,
      rgba(255,138,60,.28) 0px,
      rgba(255,138,60,.12) 1px,
      rgba(255,204,102,.08) 3px,
      transparent 6px
    );
  }
  body.quiet-phase .overlay-scan{
    opacity:.4;
  }

  .overlay-glow{
    position:fixed; inset:-40px;
    background:
      radial-gradient(circle at 20% 0%, rgba(0,255,136,.07), transparent 55%),
      radial-gradient(circle at 80% 100%, rgba(255,138,60,.14), transparent 55%);
    pointer-events:none;
    transition:filter 2s ease, opacity 2s ease;
  }
  body.orange-phase .overlay-glow{
    filter:hue-rotate(-12deg) saturate(1.3);
    opacity:.95;
  }
  body.quiet-phase .overlay-glow{
    opacity:.7;
  }

  .overlay-orb{
    position:fixed; inset:-60px;
    background:
      radial-gradient(circle at 18% 28%, rgba(0,255,136,.05) 0, transparent 50%),
      radial-gradient(circle at 72% 72%, rgba(79,208,255,.08) 0, transparent 55%),
      radial-gradient(circle at 45% 10%, rgba(255,204,102,.045) 0, transparent 45%);
    pointer-events:none;
    mix-blend-mode:screen;
    opacity:.65;
    animation:orbPulse 26s ease-in-out infinite;
  }
  body.orange-phase .overlay-orb{
    background:
      radial-gradient(circle at 16% 28%, rgba(255,138,60,.13) 0, transparent 52%),
      radial-gradient(circle at 77% 78%, rgba(255,204,102,.13) 0, transparent 55%),
      radial-gradient(circle at 50% 6%, rgba(255,255,255,.09) 0, transparent 45%);
  }
  body.quiet-phase .overlay-orb{
    opacity:.55;
  }

  .overlay-noise{
    position:fixed; inset:-120px;
    pointer-events:none;
    background:
      repeating-conic-gradient(from 15deg, rgba(0,255,136,.05) 0deg 6deg, transparent 6deg 12deg),
      repeating-linear-gradient(90deg, rgba(79,208,255,.04) 0 12px, transparent 12px 24px);
    mix-blend-mode:soft-light;
    opacity:.18;
    animation:noiseSpin 38s linear infinite;
    transition:opacity 2s ease, filter 2s ease;
  }
  body.orange-phase .overlay-noise{
    background:
      repeating-conic-gradient(from 12deg, rgba(255,138,60,.11) 0deg 6deg, transparent 6deg 12deg),
      repeating-linear-gradient(90deg, rgba(255,204,102,.05) 0 10px, transparent 10px 22px);
    opacity:.26;
  }
  body.quiet-phase .overlay-noise{
    opacity:.18;
    filter:blur(1px);
  }

  .desktop{
    position:relative;
    width:100%;
    height:100%;
    padding:18px;
    box-sizing:border-box;
  }

  .desktop::before{
    content:"";
    position:absolute;
    inset:-10px;
    background:
      linear-gradient(90deg, rgba(0,255,136,.04) 0 1px, transparent 1px 120px),
      linear-gradient(0deg, rgba(79,208,255,.035) 0 1px, transparent 1px 100px);
    background-size:120px 100px;
    opacity:.22;
    mix-blend-mode:screen;
    pointer-events:none;
    animation:gridPulse 28s linear infinite;
    transition:filter 1.6s ease, opacity 1.6s ease;
  }
  body.orange-phase .desktop::before{
    filter:hue-rotate(-18deg);
    opacity:.3;
  }
  body.quiet-phase .desktop::before{
    opacity:.22;
  }

  .win{
    position:absolute;
    --tx:0;
    --ty:16px;
    --tilt:0deg;
    --z:1;
    background:
      radial-gradient(circle at 0% 0%, rgba(255,255,255,.05), transparent 58%),
      radial-gradient(circle at 100% 0%, rgba(255,255,255,.03), transparent 50%),
      rgba(0,0,0,.9);
    border:2px solid var(--green);
    box-shadow:0 0 18px rgba(0,255,136,.5);
    color:var(--green);
    width:360px;
    max-width:90vw;
    display:flex;
    flex-direction:column;
    opacity:0;
    transform:translate3d(var(--tx), var(--ty), 0) scale(.96) rotate(var(--tilt));
    pointer-events:none;
    transition:
      opacity .7s ease,
      transform .7s ease,
      box-shadow 1s ease,
      border-color .7s ease,
      color .7s ease,
      filter .8s ease,
      opacity 1s ease;
    backdrop-filter:blur(1.2px);
    z-index:var(--z);
  }

  .win.show{
    opacity:1;
    transform:translate3d(var(--tx), 0, 0) scale(1) rotate(var(--tilt));
    pointer-events:auto;
  }

  #w-main{--tx:-50%;}
  #w-tag{--tx:-15%;}
  #w-hum{--tx:-18%;}
  #w-timer{--tx:-50%;}

  .win-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:4px 8px 6px;
    border-bottom:1px solid rgba(0,255,136,.4);
    font-size:18px;
    text-shadow:0 0 8px currentColor;
  }

  .win::before,
  .win::after{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    opacity:0;
    transition:opacity .8s ease;
  }

  .win::before{
    border:1px solid rgba(255,255,255,.06);
    mix-blend-mode:screen;
  }

  .win::after{
    inset:-14px;
    background:radial-gradient(circle at 50% 0%, rgba(255,255,255,.08), transparent 60%);
    filter:blur(10px);
    mix-blend-mode:screen;
  }

  .win.show::before{opacity:.35;}
  .win.show::after{opacity:.14;}

  .win.glitch{
    box-shadow:0 0 32px rgba(79,208,255,.85), 0 0 14px rgba(0,255,136,.55);
    filter:hue-rotate(8deg);
  }

  .win.glitch::after{opacity:.32; animation:glitchPulse .45s steps(2) infinite;}
  .win.glitch .win-header,
  .win.glitch .win-body{animation:glitchJitter .45s steps(2) infinite;}

  .win.muted{
    opacity:.65;
  }

  .hard-glitch{
    animation:hardGlitchShake .18s steps(2) infinite;
    filter:hue-rotate(-22deg) saturate(1.4) brightness(1.1);
  }

  .chaos-warp{
    animation:chaosWarp .35s infinite alternate;
  }

  .win-title{
    display:flex;
    gap:6px;
    align-items:center;
  }

  .dots{
    display:flex;
    gap:4px;
  }
  .dot{
    width:8px; height:8px; border-radius:50%;
    border:1px solid currentColor;
    opacity:.45;
  }

  .win-body{
    padding:8px 10px 10px;
    font-size:16px;
    line-height:1.25;
    white-space:pre-wrap;
    text-shadow:0 0 8px currentColor;
    max-height:50vh;
    overflow:hidden;
  }

  .win-green{
    border-color:var(--green);
    box-shadow:0 0 18px rgba(0,255,136,.55);
    color:var(--green);
    animation:softPulse 6s ease-in-out infinite;
  }

  .win-blue{
    border-color:var(--blue);
    box-shadow:0 0 22px rgba(79,208,255,.75);
    color:var(--blue);
    animation:bluePulse 10s ease-in-out infinite;
  }

  .win-orange{
    border-color: var(--orange);
    box-shadow: 0 0 22px rgba(255,138,60,.85);
    color: var(--orange);
    animation:orangePulse 8s ease-in-out infinite;
  }
  .win-orange .win-header{
    border-bottom-color:rgba(255,138,60,.5);
  }

  .win.infected{
    filter:hue-rotate(-18deg) saturate(1.2);
  }

  .flicker{
    animation:flicker 2.4s infinite;
  }
  @keyframes flicker{
    0%,8%,100%{opacity:1}
    3%{opacity:.7}
    4%{opacity:.4}
    5%{opacity:1}
  }

  @keyframes softPulse{
    0%,100%{box-shadow:0 0 18px rgba(0,255,136,.55);}
    50%{box-shadow:0 0 22px rgba(0,255,136,.75);}
  }

  @keyframes bluePulse{
    0%,100%{box-shadow:0 0 22px rgba(79,208,255,.75);}
    40%{box-shadow:0 0 28px rgba(79,208,255,.85);}
    70%{box-shadow:0 0 18px rgba(79,208,255,.65);}
  }

  @keyframes orangePulse{
    0%,100%{box-shadow:0 0 22px rgba(255,138,60,.85);}
    50%{box-shadow:0 0 30px rgba(255,204,102,.9);}
  }

  .cursor{
    display:inline-block;
    width:10px;
    height:1.05em;
    background:currentColor;
    margin-left:2px;
    animation:blink .8s steps(1) infinite;
  }
  @keyframes blink{0%,49%{opacity:1}50%,100%{opacity:0}}

  .footer{
    position:fixed;
    left:10px;
    right:10px;
    bottom:8px;
    display:flex;
    justify-content:space-between;
    font-size:14px;
    color:var(--amber);
    text-shadow:0 0 6px var(--amber);
    opacity:.8;
    padding:6px 12px;
    border:1px solid rgba(255,204,102,.25);
    background:rgba(0,0,0,.65);
    backdrop-filter:blur(2px);
    transition:color 1.4s ease, border-color 1.4s ease;
  }
  .footer span:last-child{
    color:var(--green);
  }
  body.orange-phase .footer{
    color:var(--orange);
    border-color:rgba(255,138,60,.4);
  }
  body.orange-phase .footer span:last-child{
    color:var(--amber);
  }
  body.quiet-phase .footer{
    opacity:.9;
  }

  .quiet-overlay{
    position:fixed;
    inset:0;
    pointer-events:none;
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    transition:opacity 3s ease;
    background:radial-gradient(circle at 50% 10%, rgba(0,0,0,.1) 0, rgba(0,0,0,.88) 65%);
    mix-blend-mode:screen;
    z-index:99;
  }
  .quiet-overlay.show{
    opacity:1;
  }
  .quiet-inner{
    text-align:center;
    max-width:80vw;
  }
  .quiet-line{
    font-size:26px;
    color:var(--amber);
    text-shadow:0 0 14px rgba(255,204,102,.9);
    margin-bottom:12px;
  }
  .quiet-sub{
    font-size:17px;
    color:var(--orange);
    opacity:.9;
  }

  @media (max-width:900px){
    body{
      overflow-y:auto;
      overflow-x:hidden;
    }
    .desktop{
      min-height:100vh;
      padding:14px 10px 40px;
    }
    .win{
      position:relative !important;
      top:auto !important;
      right:auto !important;
      bottom:auto !important;
      left:auto !important;
      width:100%;
      max-width:100%;
      transform-origin:center;
      transform:scale(.94) rotate(var(--tilt)) translateY(0);
      margin:0 auto;
    }
    .win.show{
      transform:scale(.96) rotate(var(--tilt));
    }
    .desktop .win + .win{
      margin-top:-14px;
    }
    .win-body{
      max-height:none;
    }
    .footer{
      position:relative;
      margin:26px 0 10px;
    }
    .quiet-line{
      font-size:22px;
    }
  }

  @keyframes bgPulse{
    0%{background-position:50% 0%;}
    100%{background-position:50% 60%;}
  }

  @keyframes scanShift{
    0%{background-position-y:0;}
    100%{background-position-y:8px;}
  }

  @keyframes orbPulse{
    0%,100%{transform:scale(1);}
    50%{transform:scale(1.03);}
  }

  @keyframes noiseSpin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
  }

  @keyframes gridPulse{
    0%,100%{opacity:.22;}
    50%{opacity:.3;}
  }

  @keyframes glitchPulse{
    0%{clip-path:inset(0 0 60% 0);}
    50%{clip-path:inset(40% 0 0 0);}
    100%{clip-path:inset(10% 0 20% 0);}
  }

  @keyframes glitchJitter{
    0%,100%{transform:translate(0,0);}
    50%{transform:translate(-1px,1px);}
  }

  @keyframes hardGlitchShake{
    0%{transform:translate(-2px,1px) skewX(-1deg);}
    50%{transform:translate(3px,-2px) skewX(2deg);}
    100%{transform:translate(-1px,2px) skewX(-2deg);}
  }

  @keyframes chaosWarp{
    0%{transform:translate3d(var(--tx),0,0) scale(1) rotate(var(--tilt));}
    50%{transform:translate3d(calc(var(--tx) + 5px), -4px,0) scale(1.04) rotate(calc(var(--tilt) + 3deg));}
    100%{transform:translate3d(calc(var(--tx) -4px), 3px,0) scale(.97) rotate(calc(var(--tilt) -3deg));}
  }

  @keyframes globalShake{
    0%{transform:translate(0,0);}
    25%{transform:translate(1px,-1px);}
    50%{transform:translate(-2px,1px);}
    75%{transform:translate(1px,2px);}
    100%{transform:translate(0,-1px);}
  }
</style>
</head>
<body>

<div class="overlay-glow"></div>
<div class="overlay-orb"></div>
<div class="overlay-scan"></div>
<div class="overlay-noise"></div>

<div class="desktop">
  <div id="w-main" class="win win-green" style="top:60px;left:50%;--z:14;--tilt:-0.2deg;">
    <div class="win-header">
      <div class="win-title">
        <span>terminal://diplomacy.os</span>
      </div>
      <div class="dots">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
    </div>
    <div class="win-body" id="mainBody"></div>
  </div>

  <div id="w-log" class="win win-green" style="bottom:70px;left:24px;width:320px;--z:6;--tilt:-0.5deg;">
    <div class="win-header">
      <div class="win-title">
        <span>syslog://trace</span>
      </div>
      <div class="dots">
        <span class="dot"></span><span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
log: INIT_BUILD_2025
log: region=UAE
log: signal_strength = rising

> cat memo.silence
> "seek diplomacy"
> awaiting_next_wave...
    </div>
  </div>

  <div id="w-info" class="win win-green" style="top:52%;left:50px;width:320px;--z:4;--tilt:0.4deg;">
    <div class="win-header">
      <div class="win-title">
        <span>about://version</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
version: 2025.10-preview
state: online
status: steady

release_notes:
 - visual_layer: repainting
 - briefings: defragmenting
 - disclosure: withheld
    </div>
  </div>

  <div id="w-uptime" class="win win-green" style="top:18px;left:18px;width:210px;--z:9;--tilt:0.6deg;">
    <div class="win-header">
      <div class="win-title">
        <span>uptime</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
uptime: 0003:14:08
watch: 2025 //
mode: attentive
trace: heartbeat audible
    </div>
  </div>

  <div id="w-archive" class="win win-green" style="top:24%;right:60%;width:230px;--z:5;--tilt:-0.7deg;">
    <div class="win-header">
      <div class="win-title">
        <span>archive://ghost_files</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body flicker">
mounting /old_world...
checksum: intact
access: read_only

note:
  some paths close
  so new ones can load.
    </div>
  </div>

  <div id="w-ghost1" class="win win-blue" style="top:30px;right:32px;width:340px;--z:13;--tilt:0.5deg;">
    <div class="win-header">
      <div class="win-title">
        <span>mirror://overlay</span>
      </div>
      <div class="dots">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
    </div>
    <div class="win-body flicker">
mirror_online = true
overlay_tint = orange
replaying_memory...

are you still there?
are you still there?
are you still listening?

no alarms raised.
the pattern simply realigns.
    </div>
  </div>

  <div id="w-ghost2" class="win win-orange" style="top:52%;left:12%;width:300px;--z:8;--tilt:-0.3deg;">
    <div class="win-header">
      <div class="win-title">
        <span>process://silent_takeover</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
injecting_new_build...
noise_level: low
notifications: suppressed

line_01: keep the cursor steady
line_02: nothing is overwritten
line_03: everything is rewritten
    </div>
  </div>

  <div id="w-ghost3" class="win win-blue" style="bottom:70px;right:30px;width:360px;--z:15;--tilt:-0.2deg;">
    <div class="win-header">
      <div class="win-title">
        <span>are_you_still_there.exe</span>
      </div>
      <div class="dots">
        <span class="dot"></span><span class="dot"></span>
      </div>
    </div>
    <div class="win-body" id="repeatBody">
    </div>
  </div>

  <div id="w-static" class="win win-blue" style="top:34%;right:55%;width:220px;--z:9;--tilt:0.9deg;">
    <div class="win-header">
      <div class="win-title">
        <span>static://feed</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body flicker">
///
//  :::
/// /////
//  :::
/// {amber}
incoming_tint: {orange}
    </div>
  </div>

  <div id="w-hum" class="win win-blue" style="top:68%;left:4%;width:230px;--z:7;--tilt:0.3deg;">
    <div class="win-header">
      <div class="win-title">
        <span>hum://background</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body flicker">
signal_floor: rising
colour_bias: {orange}

if you hear a hum,
that's just the future
buffering in.
    </div>
  </div>

  <div id="w-tag" class="win win-blue" style="top:18%;left:55%;width:260px;--z:12;--tilt:-0.4deg;">
    <div class="win-header">
      <div class="win-title">
        <span>session://diplomacy</span>
      </div>
      <div class="dots">
        <span class="dot"></span><span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
session_id: 2025
host: uae_node
mode: preview

full_interface:
   not yet deployed.
   not yet announced.
   not yet sleeping.
    </div>
  </div>

  <div id="w-signal" class="win win-blue" style="top:8%;right:50%;width:220px;--z:10;--tilt:0.1deg;">
    <div class="win-header">
      <div class="win-title">
        <span>signal://inbound</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
carrier_wave: unknown
origin: {hidden}
pattern: repeating

note:
  orange packets
  now visible to the eye.
    </div>
  </div>

  <div id="w-shadow" class="win win-blue" style="top:58%;right:18%;width:260px;">
    <div class="win-header">
      <div class="win-title">
        <span>shadow://echo</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body flicker">
feed: 001100
whisper: "preview holds"
status: serene takeover

if you feel static,
stay connected.
silence carries instructions.
    </div>
  </div>

  <div id="w-timer" class="win win-blue" style="bottom:72px;left:50%;width:240px;--z:16;--tilt:0.25deg;">
    <div class="win-header">
      <div class="win-title">
        <span>countdown://hidden</span>
      </div>
      <div class="dots">
        <span class="dot"></span>
      </div>
    </div>
    <div class="win-body">
next_update: [REDACTED]
eta: close enough.

remain logged in.
    </div>
  </div>
</div>

<div class="footer">
  <span>DIPLOMACY.OS // BUILD_2025.10 // UAE</span>
  <span>this is only a preview window.</span>
</div>

<div id="quiet-overlay" class="quiet-overlay">
  <div class="quiet-inner">
    <div class="quiet-line">the quiet will explain itself.</div>
    <div class="quiet-sub" id="quietSub">
      no feed. no noise. still a signal<span class="cursor"></span>
    </div>
  </div>
</div>

<script>
  const STAGE = 3;

  const mainLines = [
    "BOOTING DIPLOMACY.OS...",
    "mount /dev/seek_diplomacy -> /uae",
    "checking delegates_online [██████████] 100%",
    "",
    "status: legacy_interface detected.",
    "status: overlay handshake accepted.",
    "",
    "starting quiet_recompile.sh",
    "   > base_colour: neon_green",
    "   > overlay_colour: neon_orange",
    "   > notification_sounds: muted",
    "",
    "memo: sustain equilibrium.",
    "memo: standby for resonance.",
    "",
    "echo \"are you still there?\"",
    "echo \"are you still awake?\"",
    "",
    "log: preview layer aligned.",
    "log: further detail pending.",
    "",
    "hint: some signals arrive",
    "      long before their names."
  ];

  const mainBody = document.getElementById("mainBody");
  const fullMainText = mainLines.join("\n");
  let idx = 0;

  function typeMain(){
    if(idx <= fullMainText.length){
      const visible = fullMainText.slice(0, idx);
      mainBody.textContent = visible;
      mainBody.innerHTML = mainBody.textContent + '<span class="cursor"></span>';
      idx++;
      const ch = fullMainText[idx-1];
      const delay = ch === "\n" ? 70 : 22;
      setTimeout(typeMain, delay);
    }else{
      mainBody.innerHTML = mainBody.textContent + '<span class="cursor"></span>';
    }
  }

  const repeatBody = document.getElementById("repeatBody");
  const repeatLines = [
    "are you still there?",
    "are you still there?",
    "hold the line.",
    "the quiet will explain itself.",
    "no posts. no noise. still a signal."
  ];
  let repeatCount = 0;

  function addRepeatLine(){
    if(repeatCount < 32){
      const line = repeatLines[repeatCount % repeatLines.length];
      repeatBody.textContent += line + "\n";
      repeatCount++;
      const delay = line === "are you still there?" ? 130 : 260;
      setTimeout(addRepeatLine, delay);
    }
  }

  function showWin(id, delay){
    setTimeout(()=>{
      const w = document.getElementById(id);
      if(w){
        w.classList.add("show");
      }
    }, delay);
  }

  const glitchTargets = [
    "w-ghost1",
    "w-ghost2",
    "w-ghost3",
    "w-shadow",
    "w-static",
    "w-hum",
    "w-tag",
    "w-signal"
  ];

  function triggerGlitch(){
    const id = glitchTargets[Math.floor(Math.random()*glitchTargets.length)];
    const panel = document.getElementById(id);
    if(!panel || !panel.classList.contains("show")){
      scheduleGlitch();
      return;
    }
    panel.classList.add("glitch");
    if (STAGE >= 3){
      panel.classList.add("hard-glitch");
    }
    setTimeout(()=>{
      panel.classList.remove("glitch","hard-glitch");
    }, STAGE >= 3 ? 550 : 900);
    scheduleGlitch();
  }

  function scheduleGlitch(){
    let factor = 1;
    if (STAGE === 2) factor = 0.6;
    if (STAGE === 3) factor = 0.25;
    const delay = (3600 + Math.random()*3200) * factor;
    setTimeout(triggerGlitch, delay);
  }

  function corruptText(str){
    const glitchChars = ["█","▒","■","/","\\","_","?","*","#","≈","∆"];
    return str.split("").map(ch=>{
      if (ch === " " || ch === "\n") return ch;
      let p = 0;
      if (STAGE === 2) p = 0.12;
      if (STAGE === 3) p = 0.35;
      if (STAGE >= 2 && Math.random() < p){
        return glitchChars[Math.floor(Math.random()*glitchChars.length)];
      }
      return ch;
    }).join("");
  }

  function randomCorruptionTick(){
    if (STAGE < 2) return;
    const panels = document.querySelectorAll(".win-body");
    if (!panels.length) return;
    const target = panels[Math.floor(Math.random()*panels.length)];
    if (!target.dataset.original){
      target.dataset.original = target.textContent;
    }
    const base = target.dataset.original;
    target.textContent = corruptText(base);
    let interval;
    if (STAGE === 2){
      interval = 7000 + Math.random()*3500;
    } else {
      interval = 1100 + Math.random()*900;
    }
    setTimeout(randomCorruptionTick, interval);
  }

  function randomChaosTick(){
    if (STAGE < 3) return;
    const wins = Array.from(document.querySelectorAll(".win.show"));
    if (!wins.length) return;
    const w = wins[Math.floor(Math.random()*wins.length)];
    w.classList.add("chaos-warp");
    setTimeout(()=>w.classList.remove("chaos-warp"), 600 + Math.random()*600);
    const interval = 900 + Math.random()*700;
    setTimeout(randomChaosTick, interval);
  }

  function startInvasion(){
    document.body.classList.add("orange-phase");
    const allWins = document.querySelectorAll(".win");
    allWins.forEach((w, i)=>{
      setTimeout(()=>{
        if(w.classList.contains("win-green") || w.classList.contains("win-blue")){
          w.classList.remove("win-green","win-blue");
          w.classList.add("win-orange","infected");
        }else if(!w.classList.contains("win-orange")){
          w.classList.add("infected");
        }
      }, 260 * i);
    });
    const footer = document.querySelector(".footer span:last-child");
    if(footer){
      setTimeout(()=>{
        footer.textContent = "the quiet will explain itself.";
      }, 5200);
    }
  }

  function startQuietPhase(){
    document.body.classList.add("quiet-phase");
    const allWins = document.querySelectorAll(".win");
    allWins.forEach((w, i)=>{
      setTimeout(()=>{
        w.classList.add("muted");
      }, 220 * i);
    });
    const qo = document.getElementById("quiet-overlay");
    if(qo){
      setTimeout(()=>qo.classList.add("show"), 2200);
    }
    if (STAGE === 3){
      const qs = document.getElementById("quietSub");
      if(qs){
        const base = "no feed. no noise. still a signal";
        qs.innerHTML = corruptText(base) + '<span class="cursor"></span>';
      }
    }
  }

  window.addEventListener("load", ()=>{
    if (STAGE === 3){
      document.body.classList.add("stage3-shake");
    }
    showWin("w-main", 200);
    setTimeout(typeMain, 600);
    showWin("w-log", 900);
    showWin("w-info", 1200);
    showWin("w-archive", 1350);
    showWin("w-uptime", 1500);
    showWin("w-ghost1", 2600);
    showWin("w-static", 2900);
    showWin("w-ghost2", 3400);
    showWin("w-hum", 3600);
    showWin("w-ghost3", 3900);
    showWin("w-tag", 4300);
    showWin("w-signal", 4400);
    showWin("w-shadow", 4500);
    showWin("w-timer", 4900);
    setTimeout(addRepeatLine, 4500);

    setTimeout(scheduleGlitch, 5600);
    setTimeout(randomCorruptionTick, 9000);
    if (STAGE === 3){
      setTimeout(randomChaosTick, 10000);
    }

    let invasionDelay = 11500;
    let quietDelay = 15500;

    if (STAGE === 2){
      invasionDelay = 9000;
      quietDelay = 13500;
    }else if (STAGE === 3){
      invasionDelay = 6500;
      quietDelay = 11000;
    }

    setTimeout(startInvasion, invasionDelay);
    setTimeout(startQuietPhase, quietDelay);
  });
</script>
</body>
</html>
